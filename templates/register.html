{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h2>Create Account</h2>
            <p>Join Digital Class Journal today</p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} mb-4">
                        {{ message }}
                        {% if 'Email already registered' in message %}
                            <a href="{{ url_for('login') }}" class="alert-link">Login instead?</a>
                        {% endif %}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="POST" action="{{ url_for('register') }}" id="registerForm">
            <div class="form-group">
                <label for="name">Full Name</label>
                <input type="text" class="form-control" id="name" name="name" 
                       value="{{ request.form.name if request.method == 'POST' else '' }}" required>
            </div>
            
            <div class="form-group">
                 <label for="email">Email Address</label>
                 <input type="email" class="form-control" id="email" name="email" 
                 value="{% if request.method == 'POST' and 'Email already registered' not in get_flashed_messages(with_categories=true)|join('') %}{{ request.form.email }}{% endif %}" 
                 required>
            </div>
            
            <div class="form-group">
                <label for="role">Role</label>
                <select class="form-control" id="role" name="role" required>
                    <option value="">Select your role</option>
                    <option value="student" {% if request.method == 'POST' and request.form.role == 'student' %}selected{% endif %}>Student</option>
                    <option value="teacher" {% if request.method == 'POST' and request.form.role == 'teacher' %}selected{% endif %}>Teacher</option>
                    <option value="parent" {% if request.method == 'POST' and request.form.role == 'parent' %}selected{% endif %}>Parent/Guardian</option>
                    <option value="admin" {% if request.method == 'POST' and request.form.role == 'admin' %}selected{% endif %}>Admin</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" class="form-control" id="password" name="password" required>
                <small class="form-text text-muted">Minimum 8 characters</small>
            </div>
            
            <div class="form-group">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block">Register</button>
            
            <div class="auth-footer">
                <p>Already have an account? <a href="{{ url_for('login') }}">Login here</a></p>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - var(--header-height));
    padding: 20px;
}

.auth-card {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    padding: 30px;
    width: 100%;
    max-width: 450px;
}

.auth-header {
    text-align: center;
    margin-bottom: 30px;
}

.auth-header h2 {
    font-size: 24px;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.auth-header p {
    color: #6c757d;
    font-size: 14px;
}

.btn-block {
    width: 100%;
    padding: 12px;
    font-size: 16px;
}

.auth-footer {
    margin-top: 20px;
    text-align: center;
    font-size: 14px;
}

.auth-footer a {
    color: var(--primary-color);
    text-decoration: none;
}

.auth-footer a:hover {
    text-decoration: underline;
}

.form-text {
    font-size: 12px;
    color: #6c757d;
    margin-top: 5px;
}
.is-invalid {
    border-color: #dc3545;
    padding-right: calc(1.5em + 0.75rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registerForm');
    
    const flashes = document.querySelectorAll('.alert-danger');
    flashes.forEach(flash => {
        if (flash.textContent.includes('Email already registered')) {
            document.getElementById('email').value = '';
            document.getElementById('email').focus();
        }
    });
});
    
    // Password confirmation validation
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    
    function validatePassword() {
        if (password.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity("Passwords don't match");
        } else {
            confirmPassword.setCustomValidity('');
        }
    }
    
    password.onchange = validatePassword;
    confirmPassword.onkeyup = validatePassword;
</script>
{% endblock %}