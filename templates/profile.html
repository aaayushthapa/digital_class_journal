{% extends "base.html" %}

{% block title %}My Profile{% endblock %}

{% block header %}My Profile{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>Profile Picture</h3>
            </div>
            <div class="card-body text-center">
                <div class="profile-avatar-container">
                    <img src="{{ url_for('static', filename='images/default-avatar.png') }}" alt="Profile Picture" class="profile-avatar" id="profileAvatar">
                    <label for="avatarUpload" class="avatar-upload-label">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                </div>
                <h4 class="profile-name">{{ current_user.name }}</h4>
                <p class="profile-role">{{ current_user.role }}</p>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>Account Security</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-primary btn-block" id="changePasswordBtn">Change Password</button>
                <button class="btn btn-outline btn-block mt-2" id="enable2faBtn">Enable Two-Factor Auth</button>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>Personal Information</h3>
            </div>
            <div class="card-body">
                <form id="profileForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" class="form-control" id="firstName" value="John">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" class="form-control" id="lastName" value="Doe">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" class="form-control" id="email" value="john.doe@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" class="form-control" id="phone" value="+1 (555) 123-4567">
                    </div>
                    
                    <div class="form-group">
                        <label for="bio">Bio</label>
                        <textarea class="form-control" id="bio" rows="3">High school student passionate about science and technology. Currently working on renewable energy projects.</textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div class="modal" id="changePasswordModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Change Password</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" class="form-control" id="newPassword" required>
                        <small class="form-text text-muted">Minimum 8 characters, at least one number and one special character</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="savePasswordBtn">Change Password</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.profile-avatar-container {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto 20px;
}

.profile-avatar {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 5px solid #f1f3f5;
}

.avatar-upload-label {
    position: absolute;
    bottom: 10px;
    right: 10px;
    width: 40px;
    height: 40px;
    background-color: var(--primary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.profile-name {
    font-size: 20px;
    margin-bottom: 5px;
}

.profile-role {
    color: #6c757d;
    font-size: 14px;
}

.text-center {
    text-align: center;
}

.mt-2 {
    margin-top: 10px;
}

@media (max-width: 768px) {
    .col-md-4, .col-md-8 {
        flex: 0 0 100%;
        max-width: 100%;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Avatar upload functionality
    const avatarUpload = document.getElementById('avatarUpload');
    const profileAvatar = document.getElementById('profileAvatar');
    
    if (avatarUpload && profileAvatar) {
        avatarUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    profileAvatar.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Change password modal
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const changePasswordModal = document.getElementById('changePasswordModal');
    
    if (changePasswordBtn && changePasswordModal) {
        changePasswordBtn.addEventListener('click', function() {
            changePasswordModal.style.display = 'block';
        });
        
        const closeModalBtn = changePasswordModal.querySelector('.close');
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', function() {
                changePasswordModal.style.display = 'none';
            });
        }
        
        const savePasswordBtn = document.getElementById('savePasswordBtn');
        if (savePasswordBtn) {
            savePasswordBtn.addEventListener('click', function() {
                // Here you would typically validate and change the password via AJAX
                alert('Password changed successfully!');
                changePasswordModal.style.display = 'none';
            });
        }
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === changePasswordModal) {
                changePasswordModal.style.display = 'none';
            }
        });
    }
    
    // Enable 2FA button
    const enable2faBtn = document.getElementById('enable2faBtn');
    if (enable2faBtn) {
        enable2faBtn.addEventListener('click', function() {
            alert('Two-factor authentication setup will be implemented here.');
        });
    }
    
    // Profile form submission
    const profileForm = document.getElementById('profileForm');
    if (profileForm) {
        profileForm.addEventListener('submit', function(e) {
            e.preventDefault();
            // Here you would typically save the profile changes via AJAX
            alert('Profile updated successfully!');
        });
    }
});
</script>
{% endblock %}